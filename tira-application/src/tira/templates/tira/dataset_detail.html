{% extends 'tira/base.html' %}
{% load static %}
{% block title %}TIRA Datasets{% endblock %}
{% block description %}TIRA Datasets{% endblock %}
{% block navbar %}{% include "tira/navbar.html" with nav_active='dataset' %}{% endblock %}

{% block content %}
<nav class="uk-container">
<ul class="uk-breadcrumb">
<li><a href="{% url 'tira:index' %}">Tira.io</a></li>
<li> <a href="{% url 'tira:dataset' %}">Datasets</a></li>
<li class="uk-disabled"><a href="#">{{ name }}</a></li>
</ul>
</nav>

<main class="uk-section uk-section-default">
    <div class="uk-container">
        <h1>Dataset: <span class="uk-text-muted">{{ name }}</span></h1>
    </div>

    <div class="uk-container uk-margin-medium">
        <ul class="uk-list">
            <li><span data-uk-icon="chevron-down"></span> <a href="#tira-evaluation-results">Evaluation Results</a></li>
            <li><span data-uk-icon="chevron-down"></span> <a href="#tira-runs">Runs</a></li>
        </ul>
    </div>

    <div class="uk-container uk-margin-medium">
        <table class="uk-margin-medium uk-table uk-table-divider uk-table-small sortable targetable">
            <thead>
            <tr>
                <th id="tira-evaluation-results"></th>
                <th colspan="{{ ev_keys|length|add:'7' }}">
                    Results of {{ name }}
                    <a href="#" class="uk-float-right uk-link-reset" data-uk-icon="chevron-up"></a>
                </th>
            </tr>
            <tr>
                <th></th>
                <th class="header"><span>Actions</span></th>
                <th class="header"><span>User</span></th>
                <th class="header"><span>Software</span></th>
                <th class="header"><span>Run</span></th>
                <th class="header"><span>Input Run</span></th>
                {% for key in ev_keys %}
                <th class="header"><span>{{ key }}</span></th>
                {% endfor %}
                <th class="header">Runtime</th>
            </tr>
            </thead>
            <tbody>
            {% for eval in evaluations %}
            <tr>
                <td id="user-{{ eval.user_id }}"></td>
                <td></td> <!-- actions -->
                <td><a href="{% url 'tira:software-detail' user_id=eval.user_id %}">{{ eval.user_id }}</a></td>
                <td>{{ eval.software }}</td>
                <td>{{ eval.run_id }}</td>
                <td>{{ eval.input_run_id }}</td>
                {% for measure in eval.measures %}
                <td class="uk-text-truncate">{{ measure }}</td>
                {% endfor %}
                <td>{{ evaluation.runtime }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Run results - TODO only show when user is reviewer  -->
    <div class="uk-container uk-margin-medium">
        <h2 id="tira-runs">Runs</h2>
        <ul class="uk-list uk-list-collapse uk-list-striped" uk-accordion>
            {% for status, runs in users %}
            <li>
                <a class="uk-accordion-title uk-text-small" href="#">
                    <table class="uk-width-1-2"><tr>
                        <td class="uk-width-1-2 uk-text-left">{{ status.user_id }} </td>
                        <td class="uk-width-1-4 uk-text-right">{{ status.runs }} Runs</td>
                        <td class="uk-width-1-4 uk-text-right">{{ status.unreviewed }} Unreviewed</td>
                    </tr></table>
                </a>

                <div class="uk-accordion-content">
                    <table class="uk-margin-medium uk-table uk-table-divider uk-table-small sortable">
                        <thead>
                        <tr>
                            <th></th>
                            <th class="header"><span>Actions</span></th>
                            <th class="header"><span>Software</span></th>
                            <th class="header"><span>Run</span></th>
                            <th class="header"><span>Input Run</span></th>
                            <th class="header">Size</th>
                            <th class="header">Lines</th>
                            <th class="header">Files</th>
                            <th class="header">Dirs</th>
                            <th class="header">Review</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for run in runs %}
                        <tr>
                            <td></td> <!-- id? -->
                            <td>Review</td> <!-- actions review: toggle modal? or forward to the users page? -->
                            <td>{{ run.software }}</td>
                            <td>{{ run.run_id }}</td>
                            <td>{{ run.input_run_id }}</td>
                            <td>{{ run.size }}</td>
                            <td>{{ run.lines }}</td>
                            <td>{{ run.files }}</td>
                            <td>{{ run.dirs }}</td>
                            <td>{{ run.review.reviewer }}</td>
                        </tr>
                        {% endfor %}
                        </tbody>
                    </table>

                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

</main>

<script src="https://assets.webis.de/js/thirdparty/jquery/jquery.slim.min.js"></script>
<script src="https://assets.webis.de/js/thirdparty/fontawesome/fontawesome.min.js"></script>
<script src="https://assets.webis.de/js/thirdparty/fontawesome/solid.min.js"></script>
<script src="https://assets.webis.de/js/filter.js"></script>
<script src="https://assets.webis.de/js/selection.js"></script>
<script src="https://assets.webis.de/js/tables.js"></script>
<script>initWebisTableFiltering();</script>
<script>initTableSorting();</script>

{% endblock %}