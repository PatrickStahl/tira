{% extends 'tira/base.html' %}
{% load static %}
{% block title %}TIRA - My Software{% endblock %}
{% block description %}TIRA - My Software{% endblock %}
{% block navbar %}{% include "tira/navbar.html" with nav_active='software' %}{% endblock %}

{% block content %}

<nav class="uk-container">
<ul class="uk-breadcrumb">
<li><a href="{% url 'tira:index' %}">Tira.io</a></li>
<li><a href="{% url 'tira:task-detail' task_id=task.task_id%}">{{ task.task_name }}</a></li>
<li href="{% url 'tira:index' %}"><a href="#">{{ user_id }}</a></li>
</ul>
</nav>

<main class="uk-section uk-section-default">
    <div class="uk-container">
        <h1>Virtual Machine &mdash; <span class="uk-text-muted">{{ user_id }}</span></h1>
    </div>
    {% if user_id == 'no-vm-assigned' %}
     <div class="uk-container uk-margin-medium">
        <div class="uk-grid-small uk-grid-match" uk-grid>
            <div class="uk-card uk-card-body uk-card-default">
                <b>No Virtual Machine.</b>
                Your TIRA account is currently not associated with a virtual machine. Please contact us to obtain one.
            </div>
        </div>
     </div>
    {% else %}
    <!-- VM State and general options   -->
    <div class="uk-container uk-margin-medium">
        <div class="uk-child-width-1-3@m uk-grid-small uk-grid-match" uk-grid>
            <div class="uk-card uk-card-body uk-width-1-3 uk-card-default">
                <table>
                    <tr>
                        <td>OS:</td>
                    </tr>
                    <tr>
                        <td>RAM:</td>
                    </tr>
                    <tr>
                        <td>CPU:</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>Host:</td>
                    </tr>
                    <tr>
                        <td>Ssh Port:</td>
                    </tr>
                    <tr>
                        <td>Rdp Port:</td>
                    </tr>
                </table>
            </div>
            <div class="uk-card uk-card-body uk-width-2-3 uk-card-default">
                <h3 class="uk-card-title">State</h3>
                <table>
                    <tr>
                        <td>VM is Idle | VM is executing Software 1. | Vm is shut down. | VM is being sandboxed.</td>
                    </tr>
                    <tr>
                        <td>Ssh Port is (not) accessible</td>
                    </tr>
                    <tr>
                        <td>Rdp Port is (not) accessible</td>
                    </tr>
                </table>

                <div class="uk-grid-small uk-margin-small" uk-grid>
                    <div>
                        <button class="uk-button uk-button-primary uk-text-center">Start|Stop VM</button>
                    </div>
                    <div>
                        <button class="uk-button uk-button-primary uk-text-center">Abort Run</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="uk-container uk-margin-small">
        <h2>My Software</h2>
    </div>

    <!-- Softwares + Results   -->
    <div class="uk-container uk-margin">
<!-- {id, count, command, working_directory, dataset, run, creation_date, last_edit} -->
        <ul class="uk-list uk-list-collapse uk-list-striped" uk-accordion>
            {% for software in softwares %}
            <li>
                <div class="uk-child-width-1-2" uk-grid>
                    <div>Status: running</div>
                    <div class="uk-text-right">[delete]</div>
                </div>

                <a class="uk-accordion-title" href="#">{{ software.id }}</a>

                <div class="uk-accordion-content">
                    <form>
                        <div class="uk-grid-medium uk-margin-small uk-child-width-1-2" uk-grid>
                            <div>
                                <label class="uk-form-label" for="software-1-command-input">Command</label>
                                <div class="uk-form-controls">
                                    <input class="uk-input" id="software-1-command-input" type="text"
                                           value="{{ software.command }}" placeholder="Dummy Command">
                                </div>
                            </div>
                            <div>
                                <label class="uk-form-label" for="software-1-working-dir">Working Directory</label>
                                <div class="uk-form-controls">
                                    <input class="uk-input" id="software-1-working-dir" type="text"
                                           value="{{ software.working_directory }}" placeholder="/home/{{ user_id }}/">
                                </div>
                            </div>
                        </div>
                        <div class="uk-grid-medium uk-margin-small uk-child-width-1-2" uk-grid>
                            <div>
                                <label class="uk-form-label" for="software-1-input-dataset">Input Dataset</label>
                                <div class="uk-form-controls">

                                    <select class="uk-select" id="software-1-input-dataset">
                                        <option value="None">None</option>
                                        <option value="{{ software.dataset }}" selected>{{ software.dataset }}</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="uk-form-label" for="software-1-input-run">Input Run</label>
                                <div class="uk-form-controls">
                                    <select class="uk-select" id="software-1-input-run">
                                        <option>None</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                    <h2>Results</h2>
                    <table class="uk-margin-medium uk-table uk-table-divider uk-table-small targetable">
                        <thead>
                        <tr>
                            <th></th>
                            <th class="header"><span>Run</span></th>
                            <th class="header"><span>Dataset</span></th>
                            <th class="header"><span>Input Run</span></th>
                            <th class="header"><span>Review</span></th>
                            <th class="header uk-text-right">Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for run in software.results %}
                        <tr>
                            <td id="{{ user_id }}-{{ run.run_id }}"></td>
                            <td>{{ run.run_id }}</td>
                            <td>{{ run.dataset }}</td>
                            <td>{{ run.input_run_id }}</td>
                            <td>TODO: [x] no errors, [x] no output</td>
                            <td class="uk-align-right">
                                <button class="uk-button uk-button-small uk-button-primary">evaluate</button>
                                <button class="uk-button uk-button-small uk-button-default">inspect</button>
                                <button class="uk-button uk-button-small uk-button-danger">delete</button>
                            </td>
                        </tr>
                        {% for dependent in run.dependent %}
                        <tr>
                            <td id="{{ user_id }}-{{ dependent.run_id }}"></td>
                            <td>{{ dependent.run_id }}</td>
                            <td>{{ dependent.dataset }}</td>
                            <td>{{ dependent.input_run_id }}</td>
                            <td>TODO: [x] no errors, [x] no output</td>
                            <td class="uk-align-right">
                                <button class="uk-button uk-button-small uk-button-default">inspect</button>
                                <button class="uk-button uk-button-small uk-button-danger">delete</button>
                            </td>
                        </tr>
                        {% endfor %}
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>

    <div class="uk-container uk-margin-small">
        <button class="uk-button uk-button-primary uk-text-center">Add Software</button>
    </div>
    {% endif %}
</main>

{% endblock %}