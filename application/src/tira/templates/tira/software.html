{% extends 'tira/base.html' %}
{% load static %}
{% load render_bundle from webpack_loader %}
{% block title %}My TIRA{% endblock %}
{% block description %}My TIRA{% endblock %}
{% block navbar %}{% include "tira/navbar.html" with nav_active='software' %}{% endblock %}

{% block content %}
{% csrf_token %}


<div id="vue-user-mount">
<div>
    <notification-bar v-for="notification in notifications" :notification="notification" />
</div>

<main class="uk-section uk-section-default">
    <div class="uk-container">
        <h1>[[ userDisplayName ]] <span class="uk-text-muted uk-text-lead">on Task [[ task.task_name ]]</span></h1>
    </div>
    <!-- VM State and general options   -->
    <div v-if="!isDefault" class="uk-container uk-margin-medium">
        {{ isDefault }}
        <vm-control-panel
                          :csrf="csrf"
                          :vm="vm"
                          :task="task"
                          :vmstatus="vmStatus"
                          :vmstate="vmState"
                          :polling="polling"
                          :statelabels="stateLabels"
                          @addNotification="(type, message) => addNotification(type, message)"
                          @pollState="pollVmState()"
                          @pollVmInfo="loadVmInfo()"
            />
    </div>
    <div v-if="isDefault" class="uk-container uk-margin-medium">
        <div class="uk-card uk-card-body uk-card-default">
            <b>No Virtual Machine.</b>
            <br>
            Your TIRA account is currently not associated with a virtual machine.
            Without a VM, you can only use 'Upload' to submit results.
            <br>
            Please contact your task organizer to obtain a TIRA virtual machine.
        </div>
    </div>

    <div class="uk-container uk-margin-small">
        <h2>Software</h2>

        <ul uk-tab id="tira-software-tab">
            {% for sw in software %}
            <li><a href="#">{{ sw.software.id }}</a></li>
            {% endfor %}
            {% if docker %}
            {% for ds in docker.docker_softwares %}
            <li><a href="#">{{ ds.display_name }}</a></li>
            {% endfor %}
            {% endif %}
            {% if not is_default %}
            <li id="add-software">
                <a><span class="uk-margin-small-right">+</span>Add Software</a>
            </li>
            {% endif %}
            <li>
                <a href="#">Uploads</a>
            </li>
            {% if docker %}
            <li>
                <a href="#">Add Docker Software</a>
            </li>
            {% endif %}
        </ul>
        <ul class="uk-switcher uk-margin" id="tira-software-forms">
            {% for sw in software %}
                {% include "tira/software_form.html" with software=sw.software runs=sw.runs task_id=task.task_id vm_id=vm_id%}
            {% endfor %}
            {% if docker %}
            {% for ds in docker.docker_softwares %}
                {% include "tira/docker_form.html" with docker_software=ds task_id=task.task_id vm_id=vm_id%}
            {% endfor %}
            {% endif %}
            {% if not is_default %}
            <li id="add-software-row"></li>
            {% endif %}
            {% include "tira/upload_form.html" with task_id=task.task_id vm_id=vm_id upload=upload %}
            {% if docker %}
            {% include "tira/docker_form.html" with task_id=task.task_id docker=docker %}
            {% endif %}
        </ul>
    </div>
</main>

</div>

{% render_bundle 'user' %}

{#{% if not include_navigation %}#}
{#<script src="https://assets.webis.de/js/thirdparty/jquery/jquery.slim.min.js"></script>#}
{#{% endif %}#}
{#<script src="https://assets.webis.de/js/thirdparty/fontawesome/fontawesome.min.js"></script>#}
{#<script src="https://assets.webis.de/js/thirdparty/fontawesome/solid.min.js"></script>#}
{#<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>#}

{% if include_navigation %}
<script src="https://assets.webis.de/js/thirdparty/jquery/jquery.slim.min.js"></script>
<script src="https://assets.webis.de/js/thirdparty/fontawesome/fontawesome.min.js"></script>
<script src="https://assets.webis.de/js/thirdparty/fontawesome/solid.min.js"></script>
{% endif %}
<script src="https://assets.webis.de/js/filter.js"></script>
<script src="https://assets.webis.de/js/selection.js"></script>
<script src="https://assets.webis.de/js/tables.js"></script>

{# TODO #}
{#<script src="{% static 'tira/js/util.js' %}"></script>#}
{#<script src="{% static 'tira/js/software.js' %}"></script>#}
{#<script>#}
{#    addSoftwareEvents("{{ task.task_id }}", "{{ vm_id }}", "{{ is_default }}")#}
{#    setupPollingAfterPageLoad("{{ vm_id }}", "{{ is_default }}")#}
{#</script>#}

{% endblock %}
